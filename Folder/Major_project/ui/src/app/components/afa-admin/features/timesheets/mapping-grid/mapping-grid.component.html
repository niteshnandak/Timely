<div class="mt-3 px-3">
  <kendo-grid
    [data]="gridView"
    [loading]="gridLoading"
    [pageSize]="pageSize"
    [skip]="skip"
    [pageable]="{ buttonCount: 5, info: true, type: 'numeric', pageSizes: true, previousNext: true }"
    (pageChange)="pageChange($event)">

    <kendo-grid-column field="assignment_num" title="Assignment Number" *ngIf="mapping === 'mapped'"
    [headerStyle]="{'font-weight':'bold'}" [width]="110">
    </kendo-grid-column>

    <kendo-grid-column field="people_name" title="Worker Name"
    [headerStyle]="{'font-weight':'bold'}" [width]="110">
    </kendo-grid-column>

    <kendo-grid-column field="quantity" title="Hours Worked"
    [headerStyle]="{'font-weight':'bold'}" [width]="80">
    </kendo-grid-column>

    <kendo-grid-column field="unit_price" title="Hourly Pay (£)"
    [headerStyle]="{'font-weight':'bold'}" [width]="80">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div style="text-align: right;">
        <span kendoTooltip [title]="dataItem.unit_price">
          {{dataItem.unit_price | currency:'£'}}
        </span>
      </div>
    </ng-template>
    </kendo-grid-column>

    <kendo-grid-column field="description" title="Description"
    [headerStyle]="{'font-weight':'bold'}" [width]="125">
    <ng-template kendoGridCellTemplate let-dataItem>
      <span class="custom-cell text-truncate" [title]="dataItem.description">
        {{ dataItem.description }}
      </span>
    </ng-template>
    </kendo-grid-column>

    <kendo-grid-column field="mapping_status" *ngIf="invoiceStatus === 'Pending'" title="Mapping Status"
    [headerStyle]="{'font-weight':'bold'}" [width]="110">
    </kendo-grid-column>

    <kendo-grid-column *ngIf="invoiceStatus === 'Pending'" field="Action" title="Action"
    [headerStyle]="{'font-weight':'bold'}"
    [width]="80">
      <ng-template kendoGridCellTemplate let-dataItem>
        <button class="btn btn-sm btn-smaller" *ngIf="dataItem.mapping_status == 'Mapped' && dataItem.invoice_status == 'Pending'" title="Unmap this Worker" (click)="openModal('unmapping', dataItem)">
          <i class="fas fa-unlink"></i>
        </button>
        <button class="btn btn-sm btn-smaller" *ngIf="dataItem.mapping_status == 'Unmapped' && dataItem.invoice_status == 'Pending'" title="Map this Worker to Assignment" (click)="openModal('mapping', dataItem)">
          <i class="fas fa-link"></i>
        </button>
        <button class="btn btn-sm btn-smaller btn-delete" *ngIf="dataItem.invoice_status== 'Pending'" title="Delete this timesheet detail" (click)="openModal('delete', dataItem)">
          <i class="fas fa-trash"></i>
        </button>
      </ng-template>
    </kendo-grid-column>
  </kendo-grid>

  <app-modal [isVisible]="unmapModalVisible" (closeModal)="closeModal('unmapping')">
    <div class="modal-title d-flex align-items-center">
      <p class="upload-csv-header">Are you sure you want to Unmap this worker ?</p>
    </div>
    <div class="modal-content">
      <div class="upload-timesheet-form d-flex flex-column">
        <div class="upload-form-group">
          <label for="worker_name">Worker Name</label>
          <input type="text" id="worker_name" disabled placeholder="{{workerName}}">
        </div>
        <div class="upload-form-group">
          <label for="assignmet_num">Assignment</label>
          <input type="text" id = "assignment_num" disabled placeholder="{{assignmentName}}">
        </div>
        <div class="d-flex mt-1">
          <button class="submit-upload me-2" (click)="unmapTimesheetDetail()">Proceed</button>
          <button class="btn btn-outline-secondary" (click)="closeModal('unmapping')">Cancel</button>
        </div>

      </div>
    </div>
  </app-modal>


  <app-modal [isVisible]="mapModalVisible" (closeModal)="closeModal('mapping')">
    <div class="modal-title d-flex align-items-center">
      <p class="upload-csv-header">Map the Worker to an Assignment</p>
    </div>
      <div class="modal-content">
        <form [formGroup]="mapTimesheetDetailForm">
          <div class="upload-timesheet-form d-flex flex-column">
            <div class="upload-form-group" *ngIf="count === 1">
              <label for="assignment_num">Assignment Number</label>
              <input type="text" formControlName="assignment_num" readonly>
            </div>
            <div class="upload-form-group" *ngIf="count !== 1">
              <label for="assignment_num">Assignment Number</label>
              <select name="assignment_num" id="assignment_num" formControlName="assignment_num">
                <option value="" disabled selected>Select an assignment</option>
                <option *ngFor="let assignment of assignmentsForWorker" [value]="assignment.assignment_num">{{ assignment.combined }}</option>
              </select>
            </div>
            <div class="upload-form-group">
              <label for="quantity">Hours Worked</label>
              <input type="text" formControlName="quantity"
              appDecimalNumberOnly>
               <div class="error-div">
                @if (this.mapTimesheetDetailForm.get('quantity')?.errors?.['maxlength']) {
                  <b><small class="error-message" >*Hours Worked has a max length of 5</small></b>
                }
              </div>
            </div>
            <div class="upload-form-group">
              <label for="unit_price">Hourly pay</label>
              <input type="text" formControlName="unit_price" appDecimalNumberOnly>
              <div class="error-div">
                @if (this.mapTimesheetDetailForm.get('unit_price')?.errors?.['maxlength']) {
                  <b><small class="error-message" >*Hourly Pay has a max length of 6</small></b>
                }
              </div>
            </div>
            <div class="d-flex mt-1">
              <button type="submit" class="submit-upload me-2" (click)="mapFormSubmit()">Proceed</button>
              <button class="btn btn-outline-secondary" (click)="closeModal('mapping')">Cancel</button>
            </div>
          </div>
        </form>
      </div>
  </app-modal>

  <app-modal [isVisible]="deleteModalVisible" (closeModal)="closeModal('delete')" style="width:150px;">
    <div class="modal-title d-flex align-items-center">
      <p class="delete-td-csv" style="font-size: 19px;">Delete Timesheet Detail</p>
    </div>
    <div class="modal-content d-flex ">
      <hr class="seperator" style="width:100%">
      <div class="delete-td-csv d-flex mt-2">
        Are you sure want to Delete this Timesheet Detail?
      </div><br><br>
      <hr class="seperator" style="width:100%">
      <div class="d-flex mt-3 justify-content-center">
        <button class="btn btn-danger me-2" (click)="closeModal('delete')">Cancel</button>
        <button type="submit" class="btn btn-success" (click)="deleteTimesheetDetail()">Proceed</button>
      </div>
    </div>
  </app-modal>
</div>
